<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Shake Meter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }


    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        transition: background 0.3s ease;
    }

    body.low-intensity {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }

    body.medium-intensity {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    body.high-intensity {
        background: linear-gradient(135deg, #ff6b6b 0%, #ff0844 100%);
    }

    .container {
        width: 90%;
        max-width: 400px;
        text-align: center;
    }

    h1 {
        font-size: 2.5em;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .meter-container {
        position: relative;
        width: 250px;
        height: 250px;
        margin: 0 auto 40px;
    }

    .meter-circle {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
    }

    .meter-bg {
        fill: none;
        stroke: rgba(255,255,255,0.2);
        stroke-width: 20;
    }

    .meter-fill {
        fill: none;
        stroke: white;
        stroke-width: 20;
        stroke-linecap: round;
        stroke-dasharray: 0 1000;
        transition: stroke-dasharray 0.1s ease;
    }

    .meter-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .intensity-value {
        font-size: 3.5em;
        font-weight: bold;
    }

    .intensity-label {
        font-size: 1.2em;
        opacity: 0.9;
        margin-top: 5px;
    }

    .stats {
        background: rgba(255,255,255,0.15);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .stat-row {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
        font-size: 1.1em;
    }

    .stat-label {
        opacity: 0.9;
    }

    .stat-value {
        font-weight: bold;
    }

    .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    button {
        background: rgba(255,255,255,0.25);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255,255,255,0.5);
        color: white;
        padding: 15px 30px;
        border-radius: 30px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        touch-action: manipulation;
    }

    button:active {
        transform: scale(0.95);
    }

    button.active {
        background: rgba(255,100,100,0.5);
        border-color: white;
    }

    .error-message {
        background: rgba(255,0,0,0.3);
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
    }

    .permission-prompt {
        background: rgba(255,255,255,0.2);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        display: none;
    }

    @media (max-height: 700px) {
        h1 { font-size: 2em; }
        .meter-container { 
            width: 200px; 
            height: 200px; 
        }
        .intensity-value { font-size: 2.5em; }
    }
</style>


</head>
<body>
    <div class="container">
        <h1>Shake Meter üì±</h1>


    <div class="permission-prompt" id="permissionPrompt">
        ‚ö†Ô∏è Tap "Start" and allow motion access when prompted
    </div>

    <div class="meter-container">
        <svg class="meter-circle" viewBox="0 0 250 250">
            <circle class="meter-bg" cx="125" cy="125" r="105"></circle>
            <circle class="meter-fill" id="meterFill" cx="125" cy="125" r="105"></circle>
        </svg>
        <div class="meter-text">
            <div class="intensity-value" id="intensityValue">0</div>
            <div class="intensity-label" id="intensityLabel">Ready</div>
        </div>
    </div>

    <div class="stats">
        <div class="stat-row">
            <span class="stat-label">Current:</span>
            <span class="stat-value" id="currentStat">0.00 g</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Peak:</span>
            <span class="stat-value" id="peakStat">0.00 g</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Average:</span>
            <span class="stat-value" id="avgStat">0.00 g</span>
        </div>
    </div>

    <div class="controls">
        <button id="startBtn" onclick="toggleMonitoring()">Start</button>
        <button onclick="resetValues()">Reset</button>
    </div>

    <div class="error-message" id="errorMessage">
        Motion sensors not available. Make sure you're using Safari on iOS 13+
    </div>
</div>

<script>
    let isMonitoring = false;
    let currentIntensity = 0;
    let peakIntensity = 0;
    let readings = [];
    let avgReadings = [];
    const maxReadings = 50;
    const circumference = 2 * Math.PI * 105;

    // Check for iOS and Safari
    function isIOS() {
        return /iPad|iPhone|iPod/.test(navigator.userAgent) || 
               (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    }

    function toggleMonitoring() {
        if (isMonitoring) {
            stopMonitoring();
        } else {
            startMonitoring();
        }
    }

    async function startMonitoring() {
        const btn = document.getElementById('startBtn');
        const errorMsg = document.getElementById('errorMessage');
        const permissionPrompt = document.getElementById('permissionPrompt');

        // Check if DeviceMotionEvent is available
        if (typeof DeviceMotionEvent === 'undefined') {
            errorMsg.style.display = 'block';
            errorMsg.textContent = 'Motion sensors not supported on this device';
            return;
        }

        // Request permission for iOS 13+
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            permissionPrompt.style.display = 'block';
            
            try {
                const permission = await DeviceMotionEvent.requestPermission();
                permissionPrompt.style.display = 'none';
                
                if (permission !== 'granted') {
                    errorMsg.style.display = 'block';
                    errorMsg.textContent = 'Motion access denied. Please reload and allow access.';
                    return;
                }
            } catch (error) {
                errorMsg.style.display = 'block';
                errorMsg.textContent = 'Error requesting motion permission: ' + error.message;
                return;
            }
        }

        isMonitoring = true;
        btn.textContent = 'Stop';
        btn.classList.add('active');
        
        window.addEventListener('devicemotion', handleMotion);
    }

    function stopMonitoring() {
        isMonitoring = false;
        const btn = document.getElementById('startBtn');
        btn.textContent = 'Start';
        btn.classList.remove('active');
        
        window.removeEventListener('devicemotion', handleMotion);
    }

    function handleMotion(event) {
        if (!event.acceleration) return;

        const x = event.acceleration.x || 0;
        const y = event.acceleration.y || 0;
        const z = event.acceleration.z || 0;

        // Calculate magnitude (in m/s¬≤), convert to g-force
        const magnitude = Math.sqrt(x*x + y*y + z*z) / 9.81;
        
        currentIntensity = magnitude;
        
        // Update peak
        if (magnitude > peakIntensity) {
            peakIntensity = magnitude;
        }
        
        // Update rolling average
        readings.push(magnitude);
        if (readings.length > maxReadings) {
            readings.shift();
        }
        
        const avgIntensity = readings.reduce((a, b) => a + b, 0) / readings.length;
        
        avgReadings.push(avgIntensity);
        if (avgReadings.length > maxReadings) {
            avgReadings.shift();
        }
        
        avgOfAvgIntensity = avgReadings.reduce((a, b) => a + b, 0) / avgReadings.length;
        
        updateDisplay(avgIntensity, peakIntensity, avgOfAvgIntensity);
    }

    function updateDisplay(current, peak, avg) {
        // Update numeric displays
        document.getElementById('intensityValue').textContent = Math.round(current * 100);
        document.getElementById('currentStat').textContent = current.toFixed(2) + ' g';
        document.getElementById('peakStat').textContent = peak.toFixed(2) + ' g';
        document.getElementById('avgStat').textContent = avg.toFixed(2) + ' g';
        
        // Update meter fill
        const fillPercent = Math.min(current / 2, 1); // Max out at 2g
        const dashArray = fillPercent * circumference;
        document.getElementById('meterFill').style.strokeDasharray = `${dashArray} 1000`;
        
        // Update intensity label and background
        let label = 'Still';
        let bodyClass = '';
        
        if (current < 0.1) {
            label = 'Still';
            bodyClass = '';
        } else if (current < 0.3) {
            label = 'Light';
            bodyClass = 'low-intensity';
        } else if (current < 0.6) {
            label = 'Moderate';
            bodyClass = 'medium-intensity';
        } else if (current < 1.0) {
            label = 'Strong';
            bodyClass = 'medium-intensity';
        } else {
            label = 'Extreme!';
            bodyClass = 'high-intensity';
        }
        
        document.getElementById('intensityLabel').textContent = label;
        document.body.className = bodyClass;
    }

    function resetValues() {
        currentIntensity = 0;
        peakIntensity = 0;
        readings = [];
        updateDisplay(0, 0, 0);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        if (!isIOS()) {
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('errorMessage').textContent = 
                'This app works best on iPhone/iPad. Desktop browsers have limited motion sensor support.';
        }
    });
</script>

</body>
</html>
